{"version":3,"file":null,"sources":["../lib/index.js"],"sourcesContent":["import { Stream, PropagateTask } from '@tempest/core';\nexport const fold = function (f, seed, stream) {\n    switch (arguments.length) {\n        case 1: return function (seed, stream) { return fold(f, seed, stream); };\n        case 2: return function (stream) { return fold(f, seed, stream); };\n        case 3: return new Stream(new Fold(f, seed, stream.source));\n        default: return fold;\n    }\n};\nexport class Fold {\n    constructor(f, seed, source) {\n        this.f = f;\n        this.seed = seed;\n        this.source = source;\n    }\n    run(sink, scheduler) {\n        scheduler.asap(PropagateTask.event(this.seed, sink));\n        return this.source.run(new FoldSink(this.f, this.seed, sink), scheduler);\n    }\n}\nclass FoldSink {\n    constructor(f, seed, sink) {\n        this.f = f;\n        this.seed = seed;\n        this.sink = sink;\n    }\n    event(time, value) {\n        const { f } = this;\n        this.seed = f(this.seed, value);\n        this.sink.event(time, this.seed);\n    }\n    error(time, err) {\n        this.sink.error(time, err);\n    }\n    end(time, value) {\n        this.sink.end(time, this.seed);\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["const","Stream","PropagateTask"],"mappings":";;;;;;IACOA,IAAM,IAAI,GAAG,UAAU,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE;QAC3C,QAAQ,SAAS,CAAC,MAAM;YACpB,KAAK,CAAC,EAAE,OAAO,UAAU,IAAI,EAAE,MAAM,EAAE,EAAE,OAAO,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC;YACzE,KAAK,CAAC,EAAE,OAAO,UAAU,MAAM,EAAE,EAAE,OAAO,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC;YACnE,KAAK,CAAC,EAAE,OAAO,IAAIC,oBAAM,CAAC,IAAI,IAAI,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;YAC5D,SAAS,OAAO,IAAI,CAAC;SACxB;KACJ,CAAC;AACF,AAAO,IAAA,IAAM,IAAI,GAAC,aACH,CAAC,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE;QAC7B,IAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;QACf,IAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;QACrB,IAAQ,CAAC,MAAM,GAAG,MAAM,CAAC;AAC7B,IAAA,CAAK,CAAA;AACL,IAAA,eAAI,GAAG,iBAAC,IAAI,EAAE,SAAS,EAAE;QACrB,SAAa,CAAC,IAAI,CAACC,2BAAa,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;QACzD,OAAW,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,SAAS,CAAC,CAAC;AACjF,IAAA,CAAK,CAAA;AAEL,IAAA,IAAM,QAAQ,GAAC,iBACA,CAAC,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE;QAC3B,IAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;QACf,IAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;QACrB,IAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;AACzB,IAAA,CAAK,CAAA;AACL,IAAA,mBAAI,KAAK,mBAAC,IAAI,EAAE,KAAK,EAAE;QACnB,OAAe,GAAG,IAAI;YAAV,IAAA,CAAC,SAAH;QACV,IAAQ,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QACpC,IAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;AACzC,IAAA,CAAK,CAAA;AACL,IAAA,mBAAI,KAAK,mBAAC,IAAI,EAAE,GAAG,EAAE;QACjB,IAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;AACnC,IAAA,CAAK,CAAA;AACL,IAAA,mBAAI,GAAG,iBAAC,IAAI,EAAE,KAAK,EAAE;QACjB,IAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;AACvC,IAAA,CAAK,CAAA;;;;;;;"}