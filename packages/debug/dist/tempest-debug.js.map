{"version":3,"file":null,"sources":["../lib/index.js"],"sourcesContent":["import { Stream } from '@tempest/core';\nexport function debug(infoOrSpy, stream) {\n    return new Stream(new Debug(infoOrSpy, stream.source));\n}\nexport class Debug {\n    constructor(infoOrSpy, source) {\n        this.infoOrSpy = infoOrSpy;\n        this.source = source;\n    }\n    run(sink, scheduler) {\n        if (typeof this.infoOrSpy === 'object') {\n            if (typeof this.infoOrSpy.dispose === 'function') {\n                const disposeSpy = this.infoOrSpy.dispose;\n                const disposable = this.source.run(new DebugSink(this.infoOrSpy, sink), scheduler);\n                return {\n                    dispose() {\n                        disposeSpy();\n                        return disposable.dispose();\n                    }\n                };\n            }\n        }\n        else {\n            return this.source.run(new DebugSink(this.infoOrSpy, sink), scheduler);\n        }\n    }\n}\nclass DebugSink {\n    constructor(infoOrSpy, sink) {\n        this.infoOrSpy = infoOrSpy;\n        this.sink = sink;\n    }\n    event(time, value) {\n        if (typeof this.infoOrSpy === 'string') {\n            console.log(this.infoOrSpy + ':', value);\n        }\n        else if (typeof this.infoOrSpy === 'object') {\n            if (typeof this.infoOrSpy.next === 'function') {\n                this.infoOrSpy.next(value);\n            }\n        }\n        this.sink.event(time, value);\n    }\n    error(time, err) {\n        if (typeof this.infoOrSpy === 'object') {\n            if (typeof this.infoOrSpy.error === 'function') {\n                this.infoOrSpy.error(err);\n            }\n        }\n        this.sink.error(time, err);\n    }\n    end(time, value) {\n        if (typeof this.infoOrSpy === 'string') {\n            console.log(this.infoOrSpy + ': ending');\n        }\n        else if (typeof this.infoOrSpy === 'object') {\n            if (typeof this.infoOrSpy.complete === 'function') {\n                this.infoOrSpy.complete(value);\n            }\n        }\n        this.sink.end(time, value);\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["Stream"],"mappings":"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"}