{"version":3,"file":null,"sources":["../lib/index.js"],"sourcesContent":["import { Stream } from '@tempest/core';\nexport function endWhen(signal, stream) {\n    return new Stream(new EndWhen(signal.source, stream.source));\n}\nexport class EndWhen {\n    constructor(signal, source) {\n        this.signal = signal;\n        this.source = source;\n    }\n    run(sink, scheduler) {\n        const disposable = this.source.run(sink, scheduler);\n        const signalDisposable = this.signal.run({\n            event: (t, x) => {\n                sink.end(t, x);\n                disposable.dispose();\n                signalDisposable.dispose();\n            },\n            error: (t, e) => sink.error(t, e),\n            end: Function.prototype\n        }, scheduler);\n        return {\n            dispose() {\n                disposable.dispose();\n                signalDisposable.dispose();\n            }\n        };\n    }\n}\nclass EndWhenSink {\n    constructor(sink) {\n        this.sink = sink;\n    }\n    event(time, value) {\n        this.sink.event(time, value);\n    }\n    error(time, err) {\n        this.sink.error(time, err);\n    }\n    end(time, value) {\n        this.sink.end(time, value);\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["Stream"],"mappings":";;;;;;IACO,SAAS,OAAO,CAAC,MAAM,EAAE,MAAM,EAAE;QACpC,OAAO,IAAIA,oBAAM,CAAC,IAAI,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;KAChE;AACD,AAAO,IAAA,IAAM,OAAO,GAAC,gBACN,CAAC,MAAM,EAAE,MAAM,EAAE;QAC5B,IAAQ,CAAC,MAAM,GAAG,MAAM,CAAC;QACzB,IAAQ,CAAC,MAAM,GAAG,MAAM,CAAC;AAC7B,IAAA,CAAK,CAAA;AACL,IAAA,kBAAI,GAAG,iBAAC,IAAI,EAAE,SAAS,EAAE;QACrB,IAAU,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QACxD,IAAU,gBAAgB,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;YACzC,KAAS,EAAE,UAAC,CAAC,EAAE,CAAC,EAAE;gBACd,IAAQ,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACnB,UAAc,CAAC,OAAO,EAAE,CAAC;gBACzB,gBAAoB,CAAC,OAAO,EAAE,CAAC;aAC9B;YACL,KAAS,EAAE,UAAC,CAAC,EAAE,CAAC,EAAE,SAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,GAAA;YACrC,GAAO,EAAE,QAAQ,CAAC,SAAS;SAC1B,EAAE,SAAS,CAAC,CAAC;QAClB,OAAW;YACP,OAAW,kBAAA,GAAG;gBACV,UAAc,CAAC,OAAO,EAAE,CAAC;gBACzB,gBAAoB,CAAC,OAAO,EAAE,CAAC;aAC9B;SACJ,CAAC;AACV,IAAA,CAAK,CAAA,AAEL,AAIA,AAGA,AAGA;;;;;;;"}